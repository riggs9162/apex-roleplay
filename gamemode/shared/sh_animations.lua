local Anims = {}
Anims[ACT_GMOD_GESTURE_AGREE] = "Thumbs up"
Anims[ACT_GMOD_GESTURE_BECON] = "Follow me!"
Anims[ACT_GMOD_GESTURE_BOW] = "Bow"
Anims[ACT_GMOD_GESTURE_DISAGREE] = "Non-verbal no"
Anims[ACT_GMOD_GESTURE_WAVE] = "Wave"
Anims[ACT_GMOD_TAUNT_LAUGH] = "Laugh"
Anims[ACT_GMOD_TAUNT_MUSCLE] = "Dance"
Anims[ACT_GMOD_TAUNT_PERSISTENCE] = "Lion Pose"

local CitizenPhrases = {}
CitizenPhrases["Behind you"] = "vo/npc/male01/behindyou01.wav"
CitizenPhrases["Bullshit"] = "vo/npc/male01/question26.wav"
CitizenPhrases["CPs"] = "vo/npc/male01/cps01.wav"
CitizenPhrases["Cheese"] = "vo/npc/male01/question06.wav"
CitizenPhrases["Civil Protection"] = "vo/npc/male01/civilprotection01.wav"
CitizenPhrases["Combine"] = "vo/npc/male01/combine01.wav"
CitizenPhrases["Do nice"] = "vo/npc/male01/thislldonicely01.wav"
CitizenPhrases["Good god"] = "vo/npc/male01/goodgod.wav"
CitizenPhrases["Help"] = "vo/npc/male01/help01.wav"
CitizenPhrases["Hi"] = "vo/npc/male01/hi01.wav"
CitizenPhrases["Let's go"] = "vo/npc/male01/letsgo01.wav"
CitizenPhrases["Nice"] = "vo/npc/male01/nice.wav"
CitizenPhrases["Nooo"] = "vo/npc/male01/no02.wav"
CitizenPhrases["Oh no"] = "vo/npc/male01/ohno.wav"
CitizenPhrases["Okay"] = "vo/npc/male01/ok01.wav"
CitizenPhrases["Pardon me"] = "vo/npc/male01/pardonme01.wav"
CitizenPhrases["Shut up"] = "vo/npc/male01/answer17.wav"
CitizenPhrases["Sorry"] = "vo/npc/male01/sorry01.wav"
CitizenPhrases["Talk Later"] = "vo/npc/male01/answer05.wav"
CitizenPhrases["Uh oh"] = "vo/npc/male01/uhoh.wav"
CitizenPhrases["Watch out"] = "vo/npc/male01/watchout.wav"
CitizenPhrases["What now?"] = "vo/npc/male01/gordead_ques16.wav"
CitizenPhrases["Yeah"] = "vo/npc/male01/yeah02.wav"

local CPPhrases = {}
CPPhrases["Affirmative"] = "npc/metropolice/vo/affirmative.wav"
CPPhrases["Amputate"] = "npc/metropolice/vo/amputate.wav"
CPPhrases["Anti-Citizen"] = "npc/metropolice/vo/anticitizen.wav"
CPPhrases["Apply"] = "npc/metropolice/vo/apply.wav"
CPPhrases["Back me up"] = "npc/metropolice/vo/backmeupImout.wav"
CPPhrases["Copy"] = "npc/metropolice/vo/copy.wav"
CPPhrases["Cover"] = "npc/combine_soldier/vo/coverhurt.wav"
CPPhrases["Don't move"] = "npc/metropolice/vo/dontmove.wav"
CPPhrases["Grenade"] = "npc/metropolice/vo/grenade.wav"
CPPhrases["Haha"] = "npc/metropolice/vo/chuckle.wav"
CPPhrases["Help"] = "npc/metropolice/vo/help.wav"
CPPhrases["Hold it!"] = "npc/metropolice/vo/holditrightthere.wav"
CPPhrases["Hold position"] = "npc/metropolice/vo/holdthisposition.wav"
CPPhrases["I said move"] = "npc/metropolice/vo/Isaidmovealong.wav"
CPPhrases["Move along"] = "npc/metropolice/vo/movealong.wav"
CPPhrases["Move in"] = "npc/combine_soldier/vo/movein.wav"
CPPhrases["Now"] = "vo/trainyard/ba_thatbeer01.wav"
CPPhrases["Position"] = "npc/metropolice/vo/inposition.wav"
CPPhrases["Shit"] = "npc/metropolice/vo/shit.wav"
CPPhrases["Take Cover"] = "npc/metropolice/vo/takecover.wav"
CPPhrases["There he is"] = "npc/metropolice/vo/thereheis.wav"
CPPhrases["Watch it"] = "npc/metropolice/vo/watchit.wav"
CPPhrases["You can go"] = "npc/metropolice/vo/allrightyoucango.wav"

local VORTPhrases = {}
VORTPhrases["Allow me"] = "vo/npc/vortigaunt/allowme.wav"
VORTPhrases["As you wish"] = "vo/npc/vortigaunt/asyouwish.wav"
VORTPhrases["Be of service"] = "vo/npc/vortigaunt/beofservice.wav"
VORTPhrases["Behold"] = "vo/outland_02/junction/vort_junc_behold.wav"
VORTPhrases["Calm yourself"] = "vo/npc/vortigaunt/calm.wav"
VORTPhrases["Caution"] = "vo/npc/vortigaunt/caution.wav"
VORTPhrases["Done"] = "vo/npc/vortigaunt/done.wav"
VORTPhrases["Gladly"] = "vo/npc/vortigaunt/gladly.wav"
VORTPhrases["Here"] = "vo/npc/vortigaunt/here.wav"
VORTPhrases["It's an honor"] = "vo/npc/vortigaunt/itishonor.wav"
VORTPhrases["Onward"] = "vo/npc/vortigaunt/onward.wav"
VORTPhrases["Return void"] = "vo/npc/vortigaunt/returnvoid.wav"
VORTPhrases["The Extract"] = "vo/outland_03_04/tunnels/vort_extract_theextract02.wav"
VORTPhrases["This body is yours"] = "vo/npc/vortigaunt/bodyyours.wav"
VORTPhrases["This is regrettable"] = "vo/npc/vortigaunt/regrettable.wav"
VORTPhrases["Vortigese 1"] = "vo/npc/vortigaunt/vortigese11.wav"
VORTPhrases["Vortigese 2"] = "vo/npc/vortigaunt/vortigese12.wav"
VORTPhrases["Vortigese 3"] = "vo/npc/vortigaunt/vortigese09.wav"
VORTPhrases["We accompany"] = "vo/npc/vortigaunt/accompany.wav"
VORTPhrases["We are yours"] = "vo/npc/vortigaunt/weareyours.wav"
VORTPhrases["We live to serve"] = "vo/npc/vortigaunt/livetoserve.wav"
VORTPhrases["With pleasure"] = "vo/npc/vortigaunt/pleasure.wav"
VORTPhrases["Yes!"] = "vo/npc/vortigaunt/yes.wav"


function GM:GrabEarAnimation( client )
-- We hate that Ear Animation :3
end

hook.Add("CalcMainActivity", "darkrp_animations", function(client, velocity) -- Using hook.Add and not GM:CalcMainActivity to prevent animation problems
	-- Dropping weapons/money!
	if client.anim_DroppingItem then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_DROP, true)
		client.anim_DroppingItem = nil
	end

	-- Giving items!
	if client.anim_GivingItem then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_GIVE, true)
		client.anim_GivingItem = nil
	end

	if CLIENT and client.SaidHi then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_SIGNAL_GROUP, true)
		client.SaidHi = nil
	end

	if CLIENT and client.ThrewPoop then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_THROW, true)
		client.ThrewPoop = nil
	end

	if CLIENT and client.knocking then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_HL2MP_GESTURE_RANGE_ATTACK_FIST, true)
		client.knocking = nil
	end

	if CLIENT and client.usekeys then
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_PLACE, true)
		client.usekeys = nil
	end

	if not SERVER then return end

	-- Hobo throwing poop!
	local Weapon = client:GetActiveWeapon()
	if RPExtraTeams[client:Team()] and RPExtraTeams[client:Team()].hobo and not client.ThrewPoop and IsValid(Weapon) and Weapon:GetClass() == "weapon_bugbait" and client:KeyDown(IN_ATTACK) then
		client.ThrewPoop = true
		client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_GMOD_GESTURE_ITEM_THROW, true)


		local RP = RecipientFilter()
		RP:AddAllPlayers()

		umsg.Start("anim_throwpoop", RP)
			umsg.Entity(client)
		umsg.End()
	elseif client.ThrewPoop and not client:KeyDown(IN_ATTACK) then
		client.ThrewPoop = nil
	end

	-- Saying hi/hello to a player
	if not client.SaidHi and IsValid(Weapon) and Weapon:GetClass() == "weapon_physgun" and client:KeyDown(IN_ATTACK) then
		local ent = client:GetEyeTrace().Entity
		if IsValid(ent) and ent:IsPlayer() then
			client.SaidHi = true
			client:AnimRestartGesture(GESTURE_SLOT_ATTACK_AND_RELOAD, ACT_SIGNAL_GROUP, true)

			local RP = RecipientFilter()
			RP:AddAllPlayers()

			umsg.Start("anim_sayhi", RP)
				umsg.Entity(client)
			umsg.End()
		end
	elseif client.SaidHi and not client:KeyDown(IN_ATTACK) then
		client.SaidHi = nil
	end
end)

if SERVER then
	local function CustomAnim(client, cmd, args)
		local Gesture = tonumber(args[1] or 0)
		if not Anims[Gesture] then return end

		local RP = RecipientFilter()
		RP:AddAllPlayers()

		umsg.Start("_DarkRP_CustomAnim", RP)
		umsg.Entity(client)
		umsg.Short(Gesture)
		umsg.End()
	end
	concommand.Add("_DarkRP_DoAnimation", CustomAnim)

	local function DoCitizenPhrase(client, cmd, args)

		local CitizenPhrase = (args[1] or 0)
		if not table.KeyFromValue(CitizenPhrases,CitizenPhrase) then return end
		local RP = RecipientFilter()
		RP:AddAllPlayers()

		if client:Team() == TEAM_CITIZEN or client:Team() == TEAM_CWU then
			client:EmitSound(Sound(CitizenPhrase),80, 100, CHAN_VOICE)
		end
	end
	concommand.Add("HL2RP_DoCitizenPhrase", DoCitizenPhrase)

	local function DoCPPhrase(client, cmd, args)

		local CPPhrase = (args[1] or 0)
		if not table.KeyFromValue(CPPhrases,CPPhrase) then return end
		local RP = RecipientFilter()
		RP:AddAllPlayers()

		if client:Team() == TEAM_CP then
			client:EmitSound(Sound(CPPhrase),80, 100, CHAN_VOICE)
		end
	end
	concommand.Add("HL2RP_DoCPPhrase", DoCPPhrase)

	local function DoVORTPhrase(client, cmd, args)

		local VORTPhrase = (args[1] or 0)
		if not table.KeyFromValue(VORTPhrases,VORTPhrase) then return end
		local RP = RecipientFilter()
		RP:AddAllPlayers()

		if client:Team() == TEAM_VORT then
			client:EmitSound(Sound(VORTPhrase),80, 100, nil, CHAN_VOICE)
		end


	end
	concommand.Add("HL2RP_DoVORTPhrase", DoVORTPhrase)

	return
end

local function DropItem(um)
	local client = um:ReadEntity()
	if not IsValid(client) then return end

	client.anim_DroppingItem = true
end
usermessage.Hook("anim_dropitem", DropItem)

local function GiveItem(um)
	local client = um:ReadEntity()
	if not IsValid(client) then return end

	client.anim_GivingItem = true
end
usermessage.Hook("anim_giveitem", GiveItem)

local function ThrowPoop(um)
	local client = um:ReadEntity()
	if not IsValid(client) then return end

	client.ThrewPoop = true
end
usermessage.Hook("anim_throwpoop", ThrowPoop)

local function PhysgunHi(um)
	local client = um:ReadEntity()
	if not IsValid(client) then return end

	client.SaidHi = true
end
usermessage.Hook("anim_sayhi", PhysgunHi)

local function KeysAnims(um)
	local client = um:ReadEntity()
	if not IsValid(client) then return end
	local Type = um:ReadString()
	client[Type] = true
end
usermessage.Hook("anim_keys", KeysAnims)


local function CustomAnimation(um)
	local client = um:ReadEntity()
	local act = um:ReadShort()

	if not IsValid(client) then return end
	client:AnimRestartGesture(GESTURE_SLOT_CUSTOM, act, true)
end
usermessage.Hook("_DarkRP_CustomAnim", CustomAnimation)

local AnimFrame
local function AnimationMenu()
	if AnimFrame then return end

	local Panel = vgui.Create("Panel")
	Panel:SetPos(0,0)
	Panel:SetSize(ScrW(), ScrH())
	function Panel:OnMousePressed()
		AnimFrame:Close()
	end

	AnimFrame = AnimFrame or vgui.Create("DFrame", Panel)
	local Height = table.Count(Anims) * 60
	AnimFrame:SetSize(130, Height)
	AnimFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height/2))
	AnimFrame:SetTitle("Act")
	AnimFrame:SetVisible(true)
	AnimFrame:MakePopup()

	function AnimFrame:Close()
		Panel:Remove()
		AnimFrame:Remove()
		AnimFrame = nil
	end

	local i = 0
	for k,v in SortedPairs(Anims) do
		i = i + 1
		local button = vgui.Create("DButton", AnimFrame)
		button:SetPos(10, (i-1)*55 + 30)
		button:SetSize(110, 50)
		button:SetText(v)
		button:SetTextColor(Color( 255, 255, 255 ))

		button.DoClick = function()
			RunConsoleCommand("_DarkRP_DoAnimation", k)
		end
	end
	AnimFrame:SetSkin(GAMEMODE.Config.DarkRPSkin)
end
concommand.Add("_DarkRP_AnimationMenu", AnimationMenu)



/*
===============
Citizen Phrases
===============
*/

local CitizenFrame
local function CitizenMenu()
	if CitizenFrame then return end

	local CitizenPanel = vgui.Create("Panel")
	CitizenPanel:SetPos(0,0)
	CitizenPanel:SetSize(ScrW(), ScrH())
	function CitizenPanel:OnMousePressed()
		CitizenFrame:Close()
	end

	CitizenFrame = CitizenFramee or vgui.Create("DFrame", CitizenPanel)
	local Height = table.Count(CitizenPhrases) * 20 + 40
	CitizenFrame:SetSize(150, Height)
	CitizenFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height/2))
	CitizenFrame:SetTitle("Voice")
	CitizenFrame:SetVisible(true)
	CitizenFrame:MakePopup()

	function CitizenFrame:Close()
		CitizenPanel:Remove()
		CitizenFrame:Remove()
		CitizenFrame = nil
	end

	local Citizeni = 0
	for k,v in pairs(CitizenPhrases) do
		Citizeni = Citizeni + 1
		local CitizenPhraseButton = vgui.Create("DButton", CitizenFrame)
		CitizenPhraseButton:SetPos(20, (Citizeni-1)*20 + 30)
		CitizenPhraseButton:SetSize(110, 20)
		CitizenPhraseButton:SetText(k)
		CitizenPhraseButton:SetTextColor(Color( 255, 255, 255 ))
		CitizenPhraseButton.DoClick = function()
			RunConsoleCommand("HL2RP_DoCitizenPhrase", v)
		end
	end
	CitizenFrame:SetSkin(GAMEMODE.Config.DarkRPSkin)
end
concommand.Add("CitizenPhrases", CitizenMenu)

/*
================
CP Phrases
================
*/

local CPFrame
local function CPMenu()
	if CPFrame then return end

	local CPPanel = vgui.Create("Panel")
	CPPanel:SetPos(0,0)
	CPPanel:SetSize(ScrW(), ScrH())
	function CPPanel:OnMousePressed()
		CPFrame:Close()
	end

	CPFrame = CPFramee or vgui.Create("DFrame", CPPanel)
	local Height2 = table.Count(CPPhrases) * 20 + 40
	CPFrame:SetSize(150, Height2)
	CPFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height2/2))
	CPFrame:SetTitle("Voice")
	CPFrame:SetVisible(true)
	CPFrame:MakePopup()

	function CPFrame:Close()
		CPPanel:Remove()
		CPFrame:Remove()
		CPFrame = nil
	end

	local CPi = 0
	local StopSpam = 0
	for k,v in SortedPairs(CPPhrases) do
		CPi = CPi + 1
		local CPPhraseButton = vgui.Create("DButton", CPFrame)
		CPPhraseButton:SetPos(20, (CPi-1)*20 + 30)
		CPPhraseButton:SetSize(110, 20)
		CPPhraseButton:SetText(k)
		CPPhraseButton:SetTextColor(Color( 255, 255, 255 ))
		CPPhraseButton.DoClick = function()
			RunConsoleCommand("HL2RP_DoCPPhrase", v)
		end
	end
	CPFrame:SetSkin(GAMEMODE.Config.DarkRPSkin)
end
concommand.Add("CPPhrases", CPMenu)

/*
================
VORT Phrases
================
*/

local VORTFrame
local function VORTMenu()
	StopSpam = 0
	if VORTFrame then return end

	local VORTPanel = vgui.Create("Panel")
	VORTPanel:SetPos(0,0)
	VORTPanel:SetSize(ScrW(), ScrH())
	function VORTPanel:OnMousePressed()
		VORTFrame:Close()
	end

	VORTFrame = VORTFramee or vgui.Create("DFrame", VORTPanel)
	local Height2 = table.Count(VORTPhrases) * 20 + 40
	VORTFrame:SetSize(150, Height2)
	VORTFrame:SetPos(ScrW()/2 + ScrW() * 0.1, ScrH()/2 - (Height2/2))
	VORTFrame:SetTitle("Voice")
	VORTFrame:SetVisible(true)
	VORTFrame:MakePopup()

	function VORTFrame:Close()
		VORTPanel:Remove()
		VORTFrame:Remove()
		VORTFrame = nil
	end

	local VORTi = 0
	local StopSpam = 0
	for k,v in SortedPairs(VORTPhrases) do
		VORTi = VORTi + 1
		local VORTPhraseButton = vgui.Create("DButton", VORTFrame)
		VORTPhraseButton:SetPos(20, (VORTi-1)*20 + 30)
		VORTPhraseButton:SetSize(110, 20)
		VORTPhraseButton:SetText(k)
		VORTPhraseButton:SetTextColor(Color( 255, 255, 255 ))
		VORTPhraseButton.DoClick = function()
		RunConsoleCommand("HL2RP_DoVORTPhrase", v)
		end
	end
	VORTFrame:SetSkin(GAMEMODE.Config.DarkRPSkin)
end
concommand.Add("VORTPhrases", VORTMenu)
